import{_ as y,a as f,u as w,c as l,b as t,d as m,e as a,n as p,t as n,f as _,w as h,r as g,o as d,g as V,v as C,h as k}from"./index-DJ3wMxlh.js";const I={name:"VotingButtons",props:{ideaId:{type:Number,required:!0}},data(){return{voting:!1,voteCounts:{regular:{up:0,down:0},payment:{would_pay:0,would_not_pay:0}},userVotes:{regular_vote:null,payment_vote:null}}},computed:{authStore(){return w()},isAuthenticated(){return this.authStore.isLoggedIn}},async mounted(){await this.loadVoteCounts(),this.isAuthenticated&&await this.loadUserVotes()},methods:{async loadVoteCounts(){try{const o=await f.get(`/votes/idea/${this.ideaId}`);this.voteCounts=o.data}catch(o){console.error("Erreur lors du chargement des votes:",o)}},async loadUserVotes(){if(this.isAuthenticated)try{const o=await f.get(`/votes/user/${this.ideaId}`);this.userVotes=o.data}catch(o){console.error("Erreur lors du chargement des votes utilisateur:",o)}},async handleRegularVote(o){var e;if(!this.isAuthenticated){this.$router.push("/login");return}this.voting=!0;try{const i=await f.post("/votes/regular",{idea_id:this.ideaId,vote_type:o});i.data.action==="removed"?this.userVotes.regular_vote=null:this.userVotes.regular_vote=i.data.vote_type,await this.loadVoteCounts(),this.$emit("vote-updated",{type:"regular",action:i.data.action,vote_type:i.data.vote_type})}catch(i){console.error("Erreur lors du vote:",i),((e=i.response)==null?void 0:e.status)===401&&this.$router.push("/login")}finally{this.voting=!1}},async handlePaymentVote(o){var e;if(!this.isAuthenticated){this.$router.push("/login");return}this.voting=!0;try{const i=await f.post("/votes/payment",{idea_id:this.ideaId,vote_type:o});i.data.action==="removed"?this.userVotes.payment_vote=null:this.userVotes.payment_vote=i.data.vote_type,await this.loadVoteCounts(),this.$emit("vote-updated",{type:"payment",action:i.data.action,vote_type:i.data.vote_type})}catch(i){console.error("Erreur lors du vote de paiement:",i),((e=i.response)==null?void 0:e.status)===401&&this.$router.push("/login")}finally{this.voting=!1}}}},x={class:"voting-container"},S={class:"voting-section"},A={class:"vote-buttons"},D=["disabled"],E=["disabled"],B={class:"voting-section"},R={class:"payment-buttons"},U=["disabled"],N={class:"vote-count"},P=["disabled"],T={class:"vote-count"},j={key:0,class:"auth-required"};function z(o,e,i,b,s,r){const v=g("router-link");return d(),l("div",x,[t("div",S,[e[6]||(e[6]=t("h4",{class:"voting-title"},[t("i",{class:"fas fa-thumbs-up"}),a(" Votre avis ")],-1)),t("div",A,[t("button",{onClick:e[0]||(e[0]=u=>r.handleRegularVote("up")),class:p(["vote-btn","vote-up",{active:s.userVotes.regular_vote==="up"}]),disabled:s.voting},[e[4]||(e[4]=t("i",{class:"fas fa-thumbs-up"},null,-1)),t("span",null,n(s.voteCounts.regular.up),1)],10,D),t("button",{onClick:e[1]||(e[1]=u=>r.handleRegularVote("down")),class:p(["vote-btn","vote-down",{active:s.userVotes.regular_vote==="down"}]),disabled:s.voting},[e[5]||(e[5]=t("i",{class:"fas fa-thumbs-down"},null,-1)),t("span",null,n(s.voteCounts.regular.down),1)],10,E)])]),t("div",B,[e[11]||(e[11]=t("h4",{class:"voting-title"},[t("i",{class:"fas fa-coins"}),a(" Seriez-vous prêt à payer pour cette solution ? ")],-1)),t("div",R,[t("button",{onClick:e[2]||(e[2]=u=>r.handlePaymentVote("would_pay")),class:p(["payment-btn","would-pay",{active:s.userVotes.payment_vote==="would_pay"}]),disabled:s.voting},[e[7]||(e[7]=t("i",{class:"fas fa-credit-card"},null,-1)),e[8]||(e[8]=t("span",{class:"btn-text"},"Je paierais pour ça",-1)),t("span",N,n(s.voteCounts.payment.would_pay),1)],10,U),t("button",{onClick:e[3]||(e[3]=u=>r.handlePaymentVote("would_not_pay")),class:p(["payment-btn","would-not-pay",{active:s.userVotes.payment_vote==="would_not_pay"}]),disabled:s.voting},[e[9]||(e[9]=t("i",{class:"fas fa-times-circle"},null,-1)),e[10]||(e[10]=t("span",{class:"btn-text"},"Je ne paierais pas",-1)),t("span",T,n(s.voteCounts.payment.would_not_pay),1)],10,P)])]),r.isAuthenticated?m("",!0):(d(),l("div",j,[e[13]||(e[13]=t("i",{class:"fas fa-info-circle"},null,-1)),e[14]||(e[14]=t("span",null,"Connectez-vous pour voter",-1)),_(v,{to:"/login",class:"login-link"},{default:h(()=>e[12]||(e[12]=[t("i",{class:"fas fa-sign-in-alt"},null,-1),a(" Se connecter ")])),_:1,__:[12]})]))])}const F=y(I,[["render",z],["__scopeId","data-v-4f7baf46"]]),L={name:"IdeaDetail",components:{VotingButtons:F},setup(){return{ideasStore:k()}},data(){return{idea:null,loading:!0,error:null,voting:!1,commenting:!1,newComment:""}},methods:{async loadIdea(){try{this.loading=!0,this.error=null;const o=this.$route.params.id,e=await this.ideasStore.fetchIdea(o);e.success?this.idea=this.ideasStore.currentIdea:this.error=e.error||"Impossible de charger l'idée"}catch(o){this.error="Impossible de charger l'idée",console.error("Erreur:",o)}finally{this.loading=!1}},formatDate(o){return new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})},formatCurrency(o){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF"}).format(o)},getStatusText(o){return{pending:"En attente",approved:"Approuvée",featured:"Mise en avant",rejected:"Rejetée"}[o]||o},handleVoteUpdate(o){console.log("Vote mis à jour:",o)},shareIdea(){navigator.share?navigator.share({title:this.idea.title,text:this.idea.description,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),alert("Lien copié dans le presse-papiers!"))},async addComment(){if(this.newComment.trim()){this.commenting=!0;try{await new Promise(o=>setTimeout(o,500)),this.idea.comments_count++,this.newComment=""}catch(o){console.error("Erreur lors de l'ajout du commentaire:",o)}finally{this.commenting=!1}}}},mounted(){this.loadIdea()}},M={class:"idea-detail-container"},q={key:0,class:"loading-state"},J={key:1,class:"error-state"},O={key:2,class:"idea-detail"},X={class:"idea-header"},G={class:"breadcrumb"},H={class:"idea-meta"},K={class:"sector"},Q={class:"date"},W={class:"author"},Y={class:"idea-stats"},Z={class:"stat-item"},$={class:"stat-item"},tt={class:"stat-item"},et={class:"idea-actions"},st={class:"idea-content"},ot={class:"main-content"},nt={class:"description-section"},it={class:"description-text"},at={key:0,class:"audience-section"},rt={key:1,class:"budget-section"},lt={key:2,class:"willingness-section"},dt={class:"sidebar"},ut={class:"status-card"},ct={class:"author-card"},mt={class:"author-info"},pt={class:"author-details"},vt={class:"comments-section"},ft={class:"add-comment"},_t=["disabled"],ht={key:0,class:"fas fa-spinner fa-spin"},gt={key:1,class:"fas fa-paper-plane"};function yt(o,e,i,b,s,r){const v=g("router-link"),u=g("VotingButtons");return d(),l("div",M,[s.loading?(d(),l("div",q,e[3]||(e[3]=[t("div",{class:"loading-spinner"},[t("i",{class:"fas fa-spinner fa-spin"})],-1),t("p",null,"Chargement de l'idée...",-1)]))):s.error?(d(),l("div",J,[e[5]||(e[5]=t("div",{class:"error-icon"},[t("i",{class:"fas fa-exclamation-triangle"})],-1)),e[6]||(e[6]=t("h2",null,"Erreur",-1)),t("p",null,n(s.error),1),_(v,{to:"/",class:"btn btn-primary"},{default:h(()=>e[4]||(e[4]=[t("i",{class:"fas fa-home"},null,-1),a(" Retour à l'accueil ")])),_:1,__:[4]})])):s.idea?(d(),l("div",O,[t("div",X,[t("div",G,[_(v,{to:"/"},{default:h(()=>e[7]||(e[7]=[t("i",{class:"fas fa-home"},null,-1),a(" Accueil ")])),_:1,__:[7]}),e[8]||(e[8]=t("i",{class:"fas fa-chevron-right"},null,-1)),t("span",null,n(s.idea.title),1)]),t("div",H,[t("span",K,[e[9]||(e[9]=t("i",{class:"fas fa-tag"},null,-1)),a(" "+n(s.idea.sector),1)]),t("span",Q,[e[10]||(e[10]=t("i",{class:"fas fa-calendar-alt"},null,-1)),a(" "+n(r.formatDate(s.idea.created_at)),1)]),t("span",W,[e[11]||(e[11]=t("i",{class:"fas fa-user"},null,-1)),a(" "+n(s.idea.first_name)+" "+n(s.idea.last_name),1)])]),t("h1",null,n(s.idea.title),1),t("div",Y,[t("div",Z,[e[12]||(e[12]=t("i",{class:"fas fa-thumbs-up"},null,-1)),t("span",null,n(s.idea.votes_count||0)+" votes",1)]),t("div",$,[e[13]||(e[13]=t("i",{class:"fas fa-comments"},null,-1)),t("span",null,n(s.idea.comments_count||0)+" commentaires",1)]),t("div",tt,[e[14]||(e[14]=t("i",{class:"fas fa-eye"},null,-1)),t("span",null,n(s.idea.views_count||0)+" vues",1)])]),_(u,{"idea-id":s.idea.id,onVoteUpdated:r.handleVoteUpdate},null,8,["idea-id","onVoteUpdated"]),t("div",et,[t("button",{class:"btn btn-secondary",onClick:e[0]||(e[0]=(...c)=>r.shareIdea&&r.shareIdea(...c))},e[15]||(e[15]=[t("i",{class:"fas fa-share-alt"},null,-1),a(" Partager ")]))])]),t("div",st,[t("div",ot,[t("section",nt,[e[16]||(e[16]=t("h2",null,[t("i",{class:"fas fa-lightbulb"}),a(" Description ")],-1)),t("div",it,n(s.idea.description),1)]),s.idea.target_audience?(d(),l("section",at,[e[17]||(e[17]=t("h3",null,[t("i",{class:"fas fa-users"}),a(" Public cible ")],-1)),t("p",null,n(s.idea.target_audience),1)])):m("",!0),s.idea.estimated_budget?(d(),l("section",rt,[e[18]||(e[18]=t("h3",null,[t("i",{class:"fas fa-dollar-sign"}),a(" Budget estimé ")],-1)),t("p",null,n(r.formatCurrency(s.idea.estimated_budget)),1)])):m("",!0),s.idea.willingness_to_pay?(d(),l("section",lt,[e[19]||(e[19]=t("h3",null,[t("i",{class:"fas fa-credit-card"}),a(" Disposition à payer ")],-1)),t("p",null,n(s.idea.willingness_to_pay),1)])):m("",!0)]),t("div",dt,[t("div",ut,[e[20]||(e[20]=t("h3",null,"Statut de l'idée",-1)),t("span",{class:p(["status-badge",s.idea.status])},n(r.getStatusText(s.idea.status)),3)]),t("div",ct,[e[22]||(e[22]=t("h3",null,"Auteur",-1)),t("div",mt,[e[21]||(e[21]=t("div",{class:"author-avatar"},[t("i",{class:"fas fa-user-circle"})],-1)),t("div",pt,[t("h4",null,n(s.idea.first_name)+" "+n(s.idea.last_name),1),t("p",null,"@"+n(s.idea.username),1)])])])])]),t("div",vt,[t("h2",null,[e[23]||(e[23]=t("i",{class:"fas fa-comments"},null,-1)),a(" Commentaires ("+n(s.idea.comments_count||0)+") ",1)]),t("div",ft,[V(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=c=>s.newComment=c),placeholder:"Ajoutez votre commentaire...",rows:"3"},null,512),[[C,s.newComment]]),t("button",{class:"btn btn-primary",onClick:e[2]||(e[2]=(...c)=>r.addComment&&r.addComment(...c)),disabled:!s.newComment.trim()||s.commenting},[s.commenting?(d(),l("i",ht)):(d(),l("i",gt)),a(" "+n(s.commenting?"Envoi...":"Commenter"),1)],8,_t)]),e[24]||(e[24]=t("div",{class:"comments-list"},[t("div",{class:"comment-placeholder"},[t("i",{class:"fas fa-comments"}),t("p",null,"Les commentaires seront bientôt disponibles")])],-1))])])):m("",!0)])}const wt=y(L,[["render",yt],["__scopeId","data-v-3840dceb"]]);export{wt as default};
